<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Transparansi Anggaran Masjid</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

<!-- AUTH -->
<div id="auth" class="max-w-md mx-auto bg-white p-6 rounded-2xl shadow">
  <div class="flex gap-2 mb-4">
    <button onclick="showLogin()" class="flex-1 bg-green-600 text-white py-2 rounded">Login</button>
    <button onclick="showRegister()" class="flex-1 bg-gray-300 py-2 rounded">Daftar</button>
  </div>

  <!-- LOGIN -->
  <div id="loginBox">
    <input id="loginUser" placeholder="Username" class="border p-2 w-full mb-2 rounded" />
    <input id="loginPass" type="password" placeholder="Password" class="border p-2 w-full mb-2 rounded" />
    <button onclick="login()" class="bg-green-600 text-white w-full py-2 rounded">Masuk</button>
    <p id="loginError" class="text-red-500 mt-2"></p>
  </div>

  <!-- REGISTER -->
  <div id="registerBox" class="hidden">
    <input id="regUser" placeholder="Username" class="border p-2 w-full mb-2 rounded" />
    <input id="regPass" type="password" placeholder="Password" class="border p-2 w-full mb-2 rounded" />
    <button onclick="register()" class="bg-blue-600 text-white w-full py-2 rounded">Buat Akun Jamaah</button>
    <p id="regMsg" class="text-green-600 mt-2"></p>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden max-w-5xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">ðŸ“Š Transparansi Keuangan Masjid</h1>
    <button onclick="logout()" class="bg-red-500 text-white px-3 py-1 rounded">Logout</button>
  </div>

  <div id="formArea" class="bg-white p-4 rounded-2xl shadow mb-6 hidden">
    <h2 class="text-xl font-semibold mb-2">Tambah Transaksi (Bendahara)</h2>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
      <input id="tanggal" type="date" class="border p-2 rounded" />
      <select id="jenis" class="border p-2 rounded">
        <option value="masuk">Uang Masuk</option>
        <option value="keluar">Uang Keluar</option>
      </select>
      <input id="keterangan" placeholder="Keterangan" class="border p-2 rounded" />
      <input id="jumlah" type="number" placeholder="Jumlah" class="border p-2 rounded" />
      <input id="bukti" type="file" accept="image/*" class="border p-2 rounded" />
    </div>
    <button onclick="tambahTransaksi()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded">Simpan</button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-white p-4 rounded-2xl shadow"><p>Total Masuk</p><h3 id="totalMasuk" class="text-2xl font-bold text-green-600">Rp 0</h3></div>
    <div class="bg-white p-4 rounded-2xl shadow"><p>Total Keluar</p><h3 id="totalKeluar" class="text-2xl font-bold text-red-600">Rp 0</h3></div>
    <div class="bg-white p-4 rounded-2xl shadow"><p>Saldo</p><h3 id="saldo" class="text-2xl font-bold">Rp 0</h3></div>
  </div>

  <div class="bg-white p-4 rounded-2xl shadow">
    <h2 class="text-xl font-semibold mb-3">Riwayat Transaksi</h2>
    <table class="w-full text-left">
      <thead><tr class="border-b"><th class="p-2">Tanggal</th><th class="p-2">Jenis</th><th class="p-2">Keterangan</th><th class="p-2">Jumlah</th><th class="p-2">Bukti</th><th class="p-2">Aksi</th></tr></thead>
      <tbody id="tabel"></tbody>
    </table>
  </div>
</div>

<script>
// default bendahara
let users = JSON.parse(localStorage.getItem("users")) || {
  basit:{password:"123",role:"admin"}
};
localStorage.setItem("users",JSON.stringify(users));

let currentRole=null;
let data = JSON.parse(localStorage.getItem("kasMasjid")) || [];

function showRegister(){document.getElementById('loginBox').classList.add('hidden');document.getElementById('registerBox').classList.remove('hidden');}
function showLogin(){document.getElementById('registerBox').classList.add('hidden');document.getElementById('loginBox').classList.remove('hidden');}

function register(){
  const u=regUser.value.trim();
  const p=regPass.value.trim();
  if(!u||!p) return;
  if(users[u]) return regMsg.innerText="Username sudah ada";
  users[u]={password:p,role:"viewer"};
  localStorage.setItem("users",JSON.stringify(users));
  regMsg.innerText="Akun jamaah berhasil dibuat";
}

function login(){
  const u=loginUser.value;const p=loginPass.value;
  if(users[u] && users[u].password===p){
    currentRole=users[u].role;
    auth.classList.add("hidden");app.classList.remove("hidden");
    if(currentRole==="admin") formArea.classList.remove("hidden");
    render();
  }else loginError.innerText="Login gagal";
}

function logout(){location.reload();}
function formatRupiah(a){return 'Rp '+a.toLocaleString('id-ID');}
function simpan(){localStorage.setItem("kasMasjid",JSON.stringify(data));}

function tambahTransaksi(){
  if(currentRole!=="admin") return;
  const t=tanggal.value;const j=jenis.value;const k=keterangan.value;const jm=Number(jumlah.value);
  const file=bukti.files[0]; if(!t||!k||!jm) return alert("Lengkapi data");
  const reader=new FileReader();
  reader.onload=e=>{data.push({tanggal:t,jenis:j,keterangan:k,jumlah:jm,bukti:e.target.result});simpan();render();};
  if(file) reader.readAsDataURL(file); else{data.push({tanggal:t,jenis:j,keterangan:k,jumlah:jm,bukti:null});simpan();render();}
}

function hapus(i){if(currentRole!=="admin") return; if(confirm("Hapus transaksi?")){data.splice(i,1);simpan();render();}}

function render(){
  tabel.innerHTML="";let masuk=0,keluar=0;
  data.forEach((d,i)=>{
    if(d.jenis==="masuk") masuk+=d.jumlah; else keluar+=d.jumlah;
    tabel.innerHTML+=`<tr class='border-b'><td class='p-2'>${d.tanggal}</td><td class='p-2 ${d.jenis==="masuk"?"text-green-600":"text-red-600"}'>${d.jenis}</td><td class='p-2'>${d.keterangan}</td><td class='p-2'>${formatRupiah(d.jumlah)}</td><td class='p-2'>${d.bukti?`<img src='${d.bukti}' class='h-12'>`:'-'}</td><td class='p-2'>${currentRole==="admin"?`<button onclick='hapus(${i})' class='text-red-600'>Hapus</button>`:''}</td></tr>`;
  });
  totalMasuk.innerText=formatRupiah(masuk);totalKeluar.innerText=formatRupiah(keluar);saldo.innerText=formatRupiah(masuk-keluar);
}
</script>
</body>
</html>
